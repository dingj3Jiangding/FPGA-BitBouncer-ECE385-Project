#include "map.h"
#include "game_timer.h"
#include <stdint.h>

#include "player.h"

extern struct Player_animation player;
extern volatile struct BRAM_t* hdmi_ctrl;


slot_t lawn_map[32];
extern uint8_t zombie_cnt;
uint8_t state = 0;

uint32_t record_time;
uint8_t win_game = 0;
uint8_t loss_game = 0;



uint8_t digit_pix[10][32]={
		{0x99,0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x99,
		0x99,0x11,0x99,0x99,0x11,0x99,0x99,0x11,0x99,
		0x99,0x11,0x99,0x99,0x11,0x99,0x99,0x99,0x99,
		0x99,0x99,0x99},

		{0x11,0x11,0x99,0x11,0x11,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99,0x99,0x99,0x99,0x99,0x99,0x99,
		0x99,0x11,0x11,0x99,0x11,0x11,0x99,0x99,0x99,
		0x99,0x99,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99,0x99,0x99,0x99,0x99,0x99,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x99,0x99,0x99,
		0x99,0x99,0x99},

		{0x99,0x11,0x99,0x99,0x11,0x99,0x99,0x11,0x99,
		0x99,0x11,0x99,0x99,0x99,0x99,0x99,0x99,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x11,
		0x99,0x11,0x11,0x99,0x99,0x99,0x99,0x99,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x99,0x99,0x99,
		0x99,0x99,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x11,
		0x99,0x11,0x11,0x99,0x99,0x99,0x99,0x99,0x99,
		0x99,0x11,0x99,0x99,0x11,0x99,0x99,0x99,0x99,
		0x99,0x99,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x11,0x11,0x99,
		0x11,0x11,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x99,
		0x99,0x11,0x99,0x99,0x99,0x99,0x99,0x99,0x99,
		0x99,0x11,0x99,0x99,0x11,0x99,0x99,0x99,0x99,
		0x99,0x99,0x99},

		{0x99,0x99,0x99,0x99,0x99,0x99,0x99,0x11,0x99,
		0x99,0x11,0x99,0x99,0x99,0x99,0x99,0x99,0x99,
		0x11,0x11,0x99,0x11,0x11,0x99,0x99,0x99,0x99,
		0x99,0x99,0x99}
};

uint8_t digit_mapping[2] = {BG_WHITE, BG_BLACK};

void init_map(void){

	for(uint8_t i; i < 32; i++){
		lawn_map[i].plant_type = 0;
		lawn_map[i].remain_hp = 0;
		lawn_map[i].under_attack = 0;
		lawn_map[i].last_action_time = 0;
	}
}

void draw_map(BRAM_t* hdmi_ctrl){
	for(int i = 0; i < 32; i++){
		draw_plant(lawn_map[i].plant_type,i/8,i%8,hdmi_ctrl);
	}
}


void update_frame(void) {
    draw_player(&player, hdmi_ctrl);
}

uint8_t check_loss(void){
	return loss_game;
}

uint8_t check_win(void){
	return win_game;
}


